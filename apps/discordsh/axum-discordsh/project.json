{
	"name": "axum-discordsh",
	"$schema": "../../../node_modules/nx/schemas/project-schema.json",
	"projectType": "application",
	"sourceRoot": "apps/discordsh/axum-discordsh/src",
	"targets": {
		"dev": {
			"executor": "nx:run-commands",
			"options": {
				"commands": [
					"./kbve.sh -nx astro-discordsh:build",
					"STATIC_DIR=./dist/apps/astro-discordsh STATIC_PRECOMPRESSED=false cargo run -p axum-discordsh"
				],
				"parallel": false
			}
		},
		"build": {
			"executor": "@monodon/rust:build",
			"outputs": ["{options.target-dir}"],
			"options": {
				"target-dir": "dist/target/axum-discordsh"
			},
			"configurations": {
				"production": {
					"release": true
				}
			}
		},
		"test": {
			"executor": "@monodon/rust:test",
			"outputs": ["{options.target-dir}"],
			"options": {
				"target-dir": "dist/target/axum-discordsh"
			},
			"configurations": {
				"production": {
					"release": true
				}
			}
		},
		"lint": {
			"executor": "@monodon/rust:lint",
			"outputs": ["{options.target-dir}"],
			"options": {
				"target-dir": "dist/target/axum-discordsh"
			}
		},
		"run": {
			"executor": "@monodon/rust:run",
			"outputs": ["{options.target-dir}"],
			"options": {
				"target-dir": "dist/target/axum-discordsh"
			},
			"configurations": {
				"production": {
					"release": true
				}
			}
		},
		"e2e": {
			"executor": "nx:run-commands",
			"options": {
				"commands": ["nx test axum-discordsh", "nx e2e discordsh-e2e"],
				"parallel": false
			}
		},
		"container-prep": {
			"executor": "nx:run-commands",
			"options": {
				"commands": [
					"./kbve.sh -nx astro-discordsh:build",
					"rm -rf ./apps/discordsh/axum-discordsh/dist/",
					"mkdir -p ./apps/discordsh/axum-discordsh/dist/",
					"cp -a ./dist/apps/astro-discordsh/. ./apps/discordsh/axum-discordsh/dist/"
				],
				"parallel": false
			}
		},
		"container": {
			"executor": "nx:run-commands",
			"dependsOn": ["container-prep"],
			"defaultConfiguration": "local",
			"options": {
				"parallel": false
			},
			"configurations": {
				"local": {
					"commands": [
						"./kbve.sh -nx axum-discordsh:containerx",
						"VERSION=$(grep '^version' apps/discordsh/axum-discordsh/Cargo.toml | head -1 | sed 's/.*\"\\(.*\\)\"/\\1/') && docker tag kbve/discordsh:latest kbve/discordsh:$VERSION && echo \"Tagged kbve/discordsh:$VERSION\""
					]
				},
				"production": {
					"commands": [
						"./kbve.sh -nx axum-discordsh:containerx --configuration=production",
						"VERSION=$(grep '^version' apps/discordsh/axum-discordsh/Cargo.toml | head -1 | sed 's/.*\"\\(.*\\)\"/\\1/') && docker tag kbve/discordsh:latest kbve/discordsh:$VERSION && docker tag kbve/discordsh:latest ghcr.io/kbve/discordsh:latest && docker tag kbve/discordsh:latest ghcr.io/kbve/discordsh:$VERSION && echo \"Tagged kbve/discordsh:$VERSION and ghcr.io/kbve/discordsh:$VERSION\""
					]
				}
			}
		},
		"containerx": {
			"executor": "@nx-tools/nx-container:build",
			"defaultConfiguration": "local",
			"options": {
				"engine": "docker",
				"context": ".",
				"file": "apps/discordsh/axum-discordsh/Dockerfile",
				"load": true
			},
			"configurations": {
				"local": {
					"load": true,
					"push": false,
					"tags": ["kbve/discordsh:latest"]
				},
				"production": {
					"load": true,
					"push": false,
					"metadata": {
						"images": ["ghcr.io/kbve/discordsh", "kbve/discordsh"],
						"tags": ["latest"]
					},
					"build-args": [
						"BUILD_BASE=ghcr.io/kbve/discordsh-build-base:latest"
					],
					"cache-from": [
						"type=registry,ref=ghcr.io/kbve/discordsh:buildcache"
					],
					"cache-to": [
						"type=registry,ref=ghcr.io/kbve/discordsh:buildcache,mode=max"
					]
				}
			}
		},
		"basex": {
			"executor": "@nx-tools/nx-container:build",
			"defaultConfiguration": "local",
			"options": {
				"engine": "docker",
				"context": ".",
				"file": "apps/discordsh/axum-discordsh/Dockerfile.base",
				"load": true
			},
			"configurations": {
				"local": {
					"load": true,
					"push": false,
					"tags": ["ghcr.io/kbve/discordsh-build-base:latest"]
				},
				"production": {
					"load": true,
					"push": false,
					"tags": ["ghcr.io/kbve/discordsh-build-base:latest"],
					"cache-from": [
						"type=registry,ref=ghcr.io/kbve/discordsh-build-base:buildcache"
					],
					"cache-to": [
						"type=registry,ref=ghcr.io/kbve/discordsh-build-base:buildcache,mode=max"
					]
				}
			}
		},
		"base": {
			"executor": "nx:run-commands",
			"defaultConfiguration": "local",
			"options": {
				"parallel": false
			},
			"configurations": {
				"local": {
					"commands": [
						"./kbve.sh -nx axum-discordsh:basex",
						"VERSION=$(grep '^version' apps/discordsh/axum-discordsh/Cargo.toml | head -1 | sed 's/.*\"\\(.*\\)\"/\\1/') && docker tag ghcr.io/kbve/discordsh-build-base:latest ghcr.io/kbve/discordsh-build-base:$VERSION && echo \"Tagged ghcr.io/kbve/discordsh-build-base:$VERSION\""
					]
				},
				"production": {
					"commands": [
						"./kbve.sh -nx axum-discordsh:basex --configuration=production",
						"VERSION=$(grep '^version' apps/discordsh/axum-discordsh/Cargo.toml | head -1 | sed 's/.*\"\\(.*\\)\"/\\1/') && docker tag ghcr.io/kbve/discordsh-build-base:latest ghcr.io/kbve/discordsh-build-base:$VERSION && echo \"Tagged ghcr.io/kbve/discordsh-build-base:$VERSION\""
					]
				}
			}
		}
	},
	"tags": []
}
