---
import ReactNavBar from './ReactNavBar.tsx';

const currentPath = Astro.url.pathname;
---

<nav class="nav-bar not-content flex items-center gap-1">
  {/* Desktop nav links */}
  <div class="desktop-links">
    <a href="/" class:list={['nav-link', { active: currentPath === '/' || currentPath === '' }]} data-astro-prefetch title="Home">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
    </a>
    <a href="/guides/getting-started" class:list={['nav-link', { active: currentPath.startsWith('/guides') || currentPath.startsWith('/reference') }]} data-astro-prefetch title="Docs">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
    </a>
    <a href="/dashboard" class:list={['nav-link', { active: currentPath.startsWith('/dashboard') }]} data-astro-prefetch title="Dashboard">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
    </a>
  </div>

  {/* Desktop auth container â€” skeleton until React hydrates */}
  <div id="nav-auth-desktop" class="desktop-auth">
    <div class="auth-skeleton">
      <div class="honeycomb"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
    </div>
  </div>

  {/* Mobile hamburger */}
  <button id="nav-hamburger" type="button" class="hamburger-btn" aria-label="Open menu">
    <svg class="hamburger-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </button>

  {/* React handles: auth state, portals, drawer, modal */}
  <ReactNavBar client:only="react" currentPath={currentPath} />
</nav>

<style>
  .nav-bar {
    gap: 0.25rem;
  }

  .desktop-links {
    display: none;
    align-items: center;
    gap: 0.125rem;
  }

  .desktop-auth {
    display: none;
    align-items: center;
    justify-content: center;
    margin-left: 0.25rem;
    min-width: 5.5rem;
    height: 1.75rem;
    position: relative;
    border-radius: 999px;
    background-color: rgba(12, 15, 20, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.06);
  }

  .auth-skeleton {
    position: absolute;
    inset: 0;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
    transition: opacity 2s ease-in-out;
    pointer-events: none;
  }

  .desktop-auth:has([data-auth-ready]) .auth-skeleton {
    opacity: 0;
  }

  .hamburger-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.25rem;
    height: 2.25rem;
    border-radius: 0.375rem;
    border: none;
    background: none;
    color: var(--sl-color-gray-2, #a1a1aa);
    cursor: pointer;
    transition: color 150ms ease;
  }
  .hamburger-btn:hover {
    color: var(--sl-color-white, #e2e8f0);
  }
  .hamburger-icon {
    width: 1.25rem;
    height: 1.25rem;
  }

  @media (min-width: 768px) {
    .desktop-links {
      display: flex;
    }
    .desktop-auth {
      display: flex;
    }
    .hamburger-btn {
      display: none;
    }
  }

  .nav-icon {
    width: 1rem;
    height: 1rem;
    flex-shrink: 0;
    opacity: 0.8;
  }

  .nav-link {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: 0.375rem;
    color: var(--sl-color-gray-2, #94a3b8);
    text-decoration: none;
    transition: background-color 150ms ease, color 150ms ease;
  }

  .nav-link:hover {
    background-color: var(--sl-color-gray-6, rgba(148, 163, 184, 0.1));
    color: var(--sl-color-white, #e2e8f0);
  }

  .nav-link.active {
    background-color: var(--sl-color-accent-low);
    color: var(--sl-color-accent);
  }

  .nav-link:hover .nav-icon,
  .nav-link.active .nav-icon {
    opacity: 1;
  }

  @media (max-width: 767px) {
    .nav-bar {
      gap: 0.5rem;
    }
  }
</style>
