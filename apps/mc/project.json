{
	"name": "mc",
	"$schema": "../../node_modules/nx/schemas/project-schema.json",
	"projectType": "application",
	"sourceRoot": "apps/mc",
	"targets": {
		"container": {
			"executor": "nx:run-commands",
			"defaultConfiguration": "local",
			"options": {
				"parallel": false
			},
			"configurations": {
				"local": {
					"commands": [
						"./kbve.sh -nx mc:containerx",
						"VERSION=$(grep '^version' apps/mc/plugins/kbve-mc-plugin/Cargo.toml | head -1 | sed 's/.*\"\\(.*\\)\"/\\1/') && docker tag kbve/mc:latest kbve/mc:$VERSION && docker tag kbve/mc:latest kbve/mc:local && echo \"Tagged kbve/mc:$VERSION and kbve/mc:local\""
					]
				},
				"production": {
					"commands": [
						"./kbve.sh -nx mc:containerx --configuration=production",
						"VERSION=$(grep '^version' apps/mc/plugins/kbve-mc-plugin/Cargo.toml | head -1 | sed 's/.*\"\\(.*\\)\"/\\1/') && docker tag kbve/mc:latest kbve/mc:$VERSION && docker tag ghcr.io/kbve/mc:latest ghcr.io/kbve/mc:$VERSION && echo \"Tagged kbve/mc:$VERSION and ghcr.io/kbve/mc:$VERSION\""
					]
				},
				"ci": {
					"commands": [
						"./kbve.sh -nx mc:containerx --configuration=ci",
						"VERSION=$(grep '^version' apps/mc/plugins/kbve-mc-plugin/Cargo.toml | head -1 | sed 's/.*\"\\(.*\\)\"/\\1/') && docker tag kbve/mc:latest kbve/mc:$VERSION && docker tag kbve/mc:latest kbve/mc:local && echo \"Tagged kbve/mc:$VERSION and kbve/mc:local\""
					]
				}
			}
		},
		"containerx": {
			"executor": "@nx-tools/nx-container:build",
			"defaultConfiguration": "local",
			"options": {
				"engine": "docker",
				"context": "apps/mc",
				"file": "apps/mc/Dockerfile",
				"load": true
			},
			"configurations": {
				"local": {
					"load": true,
					"push": false,
					"tags": ["kbve/mc:latest"],
					"cache-from": [
						"type=registry,ref=ghcr.io/kbve/mc:buildcache"
					]
				},
				"production": {
					"load": true,
					"push": false,
					"metadata": {
						"images": ["ghcr.io/kbve/mc", "kbve/mc"],
						"tags": ["latest"]
					},
					"cache-from": [
						"type=registry,ref=ghcr.io/kbve/mc:buildcache"
					],
					"cache-to": [
						"type=registry,ref=ghcr.io/kbve/mc:buildcache,mode=max"
					]
				},
				"ci": {
					"load": true,
					"push": false,
					"tags": ["kbve/mc:latest"],
					"cache-from": ["type=gha"],
					"cache-to": ["type=gha,mode=max"]
				}
			}
		},
		"container-dev": {
			"executor": "nx:run-commands",
			"defaultConfiguration": "local",
			"options": {
				"parallel": false
			},
			"configurations": {
				"local": {
					"commands": [
						"./kbve.sh -nx mc:containerx-dev",
						"VERSION=$(grep '^version' apps/mc/plugins/kbve-mc-plugin/Cargo.toml | head -1 | sed 's/.*\"\\(.*\\)\"/\\1/') && docker tag kbve/mc:dev kbve/mc:dev-$VERSION && echo \"Tagged kbve/mc:dev-$VERSION\""
					]
				},
				"ci": {
					"commands": [
						"./kbve.sh -nx mc:containerx-dev --configuration=ci",
						"VERSION=$(grep '^version' apps/mc/plugins/kbve-mc-plugin/Cargo.toml | head -1 | sed 's/.*\"\\(.*\\)\"/\\1/') && docker tag kbve/mc:dev kbve/mc:dev-$VERSION && echo \"Tagged kbve/mc:dev-$VERSION\""
					]
				}
			}
		},
		"containerx-dev": {
			"executor": "@nx-tools/nx-container:build",
			"defaultConfiguration": "local",
			"options": {
				"engine": "docker",
				"context": "apps/mc",
				"file": "apps/mc/Dockerfile.dev",
				"load": true
			},
			"configurations": {
				"local": {
					"load": true,
					"push": false,
					"tags": ["kbve/mc:dev"]
				},
				"ci": {
					"load": true,
					"push": false,
					"tags": ["kbve/mc:dev"],
					"cache-from": ["type=gha,scope=mc-dev"],
					"cache-to": ["type=gha,scope=mc-dev,mode=max"]
				}
			}
		},
		"run": {
			"executor": "nx:run-commands",
			"options": {
				"commands": [
					"docker run --rm -p 25565:25565 -p 8080:8080 -p 25575:25575 kbve/mc:local"
				],
				"parallel": false
			}
		},
		"run-dev": {
			"executor": "nx:run-commands",
			"options": {
				"commands": [
					"docker rm -f kbve-mc-dev 2>/dev/null; mkdir -p apps/mc/logs apps/mc/world && docker run -d --name kbve-mc-dev -p 25565:25565 -p 8080:8080 -p 25575:25575 -e KBVE_TRACE=${KBVE_TRACE:-1} -v $PWD/apps/mc/logs:/pumpkin/logs -v $PWD/apps/mc/world:/pumpkin/world kbve/mc:dev && echo 'Started kbve-mc-dev (detached). Logs: nx stop-dev to stop.'"
				],
				"parallel": false
			}
		},
		"stop-dev": {
			"executor": "nx:run-commands",
			"options": {
				"commands": [
					"docker stop kbve-mc-dev 2>/dev/null && docker rm kbve-mc-dev 2>/dev/null && echo 'Stopped kbve-mc-dev' || echo 'kbve-mc-dev is not running'"
				],
				"parallel": false
			}
		},
		"restart-dev": {
			"executor": "nx:run-commands",
			"options": {
				"commands": [
					"nx stop-dev mc --no-cloud && nx run-dev mc --no-cloud"
				],
				"parallel": false
			}
		},
		"submodule-update": {
			"executor": "nx:run-commands",
			"options": {
				"commands": ["git submodule update --remote apps/mc/pumpkin"],
				"parallel": false
			}
		},
		"e2e": {
			"executor": "nx:run-commands",
			"cache": false,
			"defaultConfiguration": "local",
			"options": {
				"parallel": false
			},
			"configurations": {
				"local": {
					"commands": [
						"nx container mc --configuration=local --no-cloud",
						"nx e2e mc-e2e --no-cloud"
					]
				},
				"ci": {
					"commands": [
						"nx container mc --configuration=ci --no-cloud",
						"nx e2e mc-e2e --no-cloud"
					]
				}
			}
		}
	},
	"tags": []
}
