---
import Layout from 'src/layouts/core/Layout.astro';
import DashLayout from 'src/layouts/components/dashboard/layout/DashLayout.astro';

import {OAuth} from 'src/layouts/client/supabase/auth/OAuth';
const pageTitle: string = `Authenticating | KBVE`;
const title: string = `Logging you in...`;
const subTitle: string = `Please wait while we complete your login.`;
---

<Layout title={pageTitle}>
  <DashLayout>
  <section class="px-6 py-24 flex flex-col items-center justify-center min-h-[60vh]">
    <div class="bg-neutral-100 dark:bg-neutral-900 rounded-2xl shadow-lg p-8 flex flex-col items-center max-w-md w-full">
      <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-cyan-400 mb-6"></div>
      <h1 class="text-3xl font-bold text-neutral-900 dark:text-white mb-2">{title}</h1>
      <h2 class="text-lg text-neutral-700 dark:text-zinc-200 mb-4">{subTitle}</h2>
      <p class="text-neutral-600 dark:text-zinc-400 text-center mb-2">You are being securely logged in via OAuth. If you are not redirected automatically, <a href="/profile" data-astro-prefetch class="underline text-cyan-600 dark:text-cyan-400">click here</a>.</p>
      <div id="oauth-handler">
        <OAuth client:only="react" />
      </div>
      <script is:inline>
console.log("Current URL:", window.location.href);
console.log("Stored PKCE verifier:", window.localStorage.getItem('supabase.auth.verifier'));
      </script>
    </div>
  </section>
  </DashLayout>
</Layout>