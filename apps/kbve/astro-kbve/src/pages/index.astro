---
import Layout from 'src/layouts/core/Layout.astro';
import BentoGrid from 'src/layouts/components/bento/BentoGrid.astro';
import BentoTile from 'src/layouts/components/bento/BentoTile.astro';

function withBaseUrl(path: string, base: URL | string): string {
	return new URL(path, base).toString();
}


const tiles = [
	{
		title: 'Join Our Tech & Gaming Community!',
		subtitle: 'Our Discord is active and fun!',
		description: 'From cloud-native development to competitive gaming, we\'re here to help you level up! Whether you\'re containerizing apps or climbing ranked, our community\'s got your back.',
		span: 'col-span-3 row-span-1',
		primaryColor: 'emerald-500',
		secondaryColor: 'cyan-600',
		href: withBaseUrl('/discord', Astro.url),
		target: '_self',
		icon: 'ðŸŽ®'
	},
] as const;

const discordUrl = withBaseUrl('/discord', Astro.url);
---

<Layout title="KBVE KiloByte Virtual Enterprise">
	<BentoGrid>
		{tiles.map(tile => (
			<BentoTile {...tile} />
		))}
	</BentoGrid>
</Layout>

<!-- 
<script is:inline>
	async function injectBentoTileFromFooter() {

	while (!window.kbve?.mod || Object.keys(window.kbve.mod.registry).length === 0) {
		console.log('[Injection]: Mod Not Found')
		await new Promise((r) => setTimeout(r, 100));
	}

	const modId = Object.keys(window.kbve?.mod?.registry || {}).find(id => id.startsWith('bento@'));

	if (!modId) {
		console.warn('[Footer] Bento mod not found');
		return;
	}

	const bento = window.kbve.mod.registry[modId];

	if (bento?.instance?.run) {
		bento.instance.run({
			title: 'âœ… Vanilla Triggered',
			icon: 'ðŸ”—',
			subtitle: 'From outside the ecosystem',
			description: 'This tile was triggered via vanilla JS.',
			primaryColor: 'cyan-500',
			secondaryColor: 'blue-600',
			variant: 'default',
			span: 'col-span-2 row-span-1',
		});
	} else {
		console.warn('[Footer] Bento mod loaded, but run() not available');
	}
}

// Initial load
document.addEventListener('DOMContentLoaded', injectBentoTileFromFooter);
// View transition (Astro)
document.addEventListener('astro:page-load', injectBentoTileFromFooter);

</script> -->