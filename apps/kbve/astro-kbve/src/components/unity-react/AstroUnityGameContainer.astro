---
/**
 * AstroUnityGameContainer
 * Main Astro component for Unity WebGL integration
 * ReactUnity connects directly to the SharedWorker (no provider wrapper needed)
 */

import { ReactUnity } from './ReactUnity';
import type { UnityConfig } from './typeUnity';

export interface Props {
	/**
	 * Unity build configuration
	 */
	config: UnityConfig;

	/**
	 * CSS class name for the container
	 */
	className?: string;

	/**
	 * Canvas ID (default: 'unity-canvas')
	 */
	canvasId?: string;

	/**
	 * Whether to show fullscreen button (default: true)
	 */
	showFullscreenButton?: boolean;

	/**
	 * Whether to start in fullscreen mode (default: false)
	 */
	startFullscreen?: boolean;

	/**
	 * Container width (default: '100%')
	 */
	width?: string;

	/**
	 * Container height (default: '600px')
	 */
	height?: string;
}

const {
	config,
	className = '',
	canvasId = 'unity-canvas',
	showFullscreenButton = true,
	startFullscreen = false,
	width = '100%',
	height = '600px',
} = Astro.props;
---

<div
	class={`astro-unity-game-container ${className}`}
	style={`width: ${width}; height: ${height}; position: relative;`}>
	<!-- ReactUnity connects directly to SharedWorker (same as ReactNav) -->
	<ReactUnity
		client:only="react"
		config={config}
		canvasId={canvasId}
		showFullscreenButton={showFullscreenButton}
		startFullscreen={startFullscreen}
		className="astro-unity-react"
	/>
</div>

<style>
	.astro-unity-game-container {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		background: #000;
		border-radius: 8px;
		overflow: hidden;
		box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
	}

	.astro-unity-react {
		width: 100%;
		height: 100%;
	}

	/* Loading spinner styles */
	:global(.unity-loading) {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: 100%;
		color: white;
	}

	:global(.unity-loading-content) {
		text-align: center;
		max-width: 300px;
		width: 100%;
	}

	:global(.unity-loading-spinner) {
		width: 50px;
		height: 50px;
		margin: 0 auto 1rem;
		border: 4px solid rgba(255, 255, 255, 0.1);
		border-top-color: #4caf50;
		border-radius: 50%;
		animation: unity-spin 1s linear infinite;
	}

	@keyframes unity-spin {
		to {
			transform: rotate(360deg);
		}
	}

	:global(.unity-loading-bar) {
		width: 100%;
		height: 8px;
		background: rgba(255, 255, 255, 0.1);
		border-radius: 4px;
		overflow: hidden;
		margin-bottom: 1rem;
	}

	:global(.unity-loading-bar-fill) {
		height: 100%;
		background: linear-gradient(90deg, #4caf50 0%, #8bc34a 100%);
		transition: width 0.3s ease;
		border-radius: 4px;
	}

	:global(.unity-loading-text) {
		margin: 0;
		font-size: 0.875rem;
		color: rgba(255, 255, 255, 0.8);
	}

	/* Responsive styles */
	@media (max-width: 768px) {
		.astro-unity-game-container {
			border-radius: 0;
		}
	}

	/* Fullscreen styles */
	:global(.unity-container:fullscreen) {
		width: 100vw !important;
		height: 100vh !important;
	}

	:global(.unity-container:-webkit-full-screen) {
		width: 100vw !important;
		height: 100vh !important;
	}

	:global(.unity-container:-moz-full-screen) {
		width: 100vw !important;
		height: 100vh !important;
	}

	:global(.unity-container:-ms-fullscreen) {
		width: 100vw !important;
		height: 100vh !important;
	}
</style>
