---
import { clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';
import type { BentoTile } from '@kbve/droid';
import { BentoTileSchema } from '@kbve/droid';

export type Props = BentoTile;

const props = BentoTileSchema.parse(Astro.props);

const {
	title,
	subtitle = 'Learn More',
	description = '',
	icon,
	span = 'col-span-1 row-span-1 sm:col-span-2 sm:row-span-1',
	onclick,
	href = '/',
	target = '_blank',
	primaryColor = 'zinc-500',
	secondaryColor = 'stone-900',
	backgroundImage,
	role = 'region',
	ariaLabel = title,
	className = '',
	meta = new Uint8Array(),
} = props;

const isLargeTile = span.includes('col-span-3') || span.includes('row-span-3');

const responsiveSpan = span
	.split(' ')
	.map((s) => (s.startsWith('sm:') ? s : `sm:${s}`))
	.join(' ');

const classes = twMerge(
	clsx(
		'bento-item',
		'col-span-1 row-span-1',
		responsiveSpan,
		'relative overflow-hidden rounded-2xl hover:scale-[1.01] transition-all duration-300 cursor-pointer group animate-fade-in',
		'bg-white/5 backdrop-blur-md ring-1 ring-white/10 ring-offset-1 ring-offset-white/5',
		'shadow-[inset_0_0_0.5px_rgba(255,255,255,0.15),inset_0_1px_0_rgba(255,255,255,0.08),0_20px_40px_rgba(0,0,0,0.4)]',
		'hover:shadow-[inset_0_0_1px_rgba(255,255,255,0.2),inset_0_2px_1px_rgba(255,255,255,0.1),0_30px_60px_rgba(0,0,0,0.5)]',
		'p-6 flex flex-col justify-between space-y-4 text-white',
		className
	)
);

const backgroundStyle = backgroundImage
	? `background-image: url('${backgroundImage}'); background-size: cover; background-position: center;`
	: '';
---

<div class={classes} role={role} aria-label={ariaLabel} onclick={onclick} style={backgroundStyle}>
	<!-- Glow Layer Fills the Entire Tile -->
	<div class="absolute inset-0 rounded-[1.25rem] pointer-events-none z-0 border border-[rgba(34,211,238,0.1)]
		shadow-[inset_0.5px_0.5px_1.5px_rgba(186,230,253,0.6),inset_-1px_-1px_1px_rgba(21,94,117,0.5),inset_3px_3px_6px_rgba(0,0,0,0.25)]">
	</div>

	<!-- Foreground Content Layer -->
	<div class="relative z-10 flex flex-col justify-between h-full min-h-0 space-y-4">
		<div class="flex-1 min-h-0 overflow-hidden">
			<h3 class="text-2xl font-bold mb-2 text-white drop-shadow-md">{title}</h3>
			<p class="text-sm text-zinc-300 leading-relaxed">{description}</p>
		</div>

		<div class="pt-2">
			<a
				href={href}
				target={target}
				class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-br from-cyan-400 to-cyan-500 text-white font-semibold rounded-full shadow hover:from-cyan-300 hover:to-cyan-400 transition duration-200 ease-in-out text-sm">
				{icon && <span class="w-5 h-5"><Fragment set:html={icon} /></span>}
				<span>{subtitle}</span>
			</a>
		</div>
	</div>
</div>

