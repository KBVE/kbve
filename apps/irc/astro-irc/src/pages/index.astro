---
import Layout from '../layouts/Layout.astro';
---

<Layout title="KBVE IRC" description="KBVE IRC Chat Client">
  <main class="min-h-screen flex flex-col items-center justify-center p-4">
    <div class="max-w-lg w-full text-center">
      <h1 class="text-4xl font-bold mb-2 text-white">KBVE IRC</h1>
      <p class="text-gray-400 mb-8">Authenticated chat powered by Ergo IRC</p>

      <div class="bg-[#161b22] border border-[#30363d] rounded-lg p-6 mb-6">
        <div class="flex items-center justify-center gap-2 mb-4">
          <span id="status-dot" class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
          <span id="status-text" class="text-sm text-gray-400">Checking gateway...</span>
        </div>
        <p class="text-gray-500 text-sm">
          Sign in with your KBVE account to start chatting.
        </p>
      </div>

      <a
        href="/auth"
        class="inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-medium transition-colors"
      >
        Sign In to Chat
      </a>

      <p class="mt-8 text-xs text-gray-600">
        <a href="https://kbve.com" class="text-indigo-400 hover:text-indigo-300">kbve.com</a>
      </p>
    </div>
  </main>

  <script>
    fetch('/health')
      .then((r) => r.text())
      .then((t) => {
        const dot = document.getElementById('status-dot');
        const text = document.getElementById('status-text');
        if (t === 'OK') {
          if (text) text.textContent = 'Gateway online';
        } else {
          if (dot) dot.className = 'w-2 h-2 rounded-full bg-yellow-500';
          if (text) text.textContent = 'Gateway degraded';
        }
      })
      .catch(() => {
        const dot = document.getElementById('status-dot');
        const text = document.getElementById('status-text');
        if (dot) dot.className = 'w-2 h-2 rounded-full bg-red-500';
        if (text) text.textContent = 'Gateway unreachable';
      });
  </script>
</Layout>
