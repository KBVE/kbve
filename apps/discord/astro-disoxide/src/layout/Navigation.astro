---
/** @jsxImportSource astro */
// Navigation.astro - Modern navigation with component-specific skeletons
import ReactNav from './template/nav/ReactNav';

export interface Props {
  class?: string;
}

const { class: className = '' } = Astro.props;
---

<!-- Navigation Container -->
<div class={`flex items-center ${className}`}>
  <!-- Logo (Static, not in React) -->
  <a href="/" class="flex items-center gap-2 text-white hover:text-purple-400 transition-colors duration-200" aria-label="Logo" data-astro-prefetch>
    <img 
      src="/assets/media/logo/discordsh_logo.webp" 
      alt="Discord.sh Logo" 
      class="object-contain w-24 rounded-full"
      data-logo="image"
    />
  </a>

  <!-- React Navigation Content -->
  <div id="react-navigation" class="flex-1 flex items-center justify-end gap-4">
    
    <!-- Home Menu Item -->
    <div data-nav="menu-home" class="hidden">
      <!-- Skeleton -->
      <div data-skeleton="menu-home" class="flex flex-col items-center justify-center p-2 animate-pulse">
        <div class="w-6 h-6 mb-1 bg-gray-600 rounded"></div>
        <div class="w-8 h-2 bg-gray-600 rounded"></div>
      </div>
      <!-- Actual Content (hidden initially) -->
      <a
        data-content="menu-home"
        href="/"
        class="hidden flex-col items-center justify-center p-2 text-xs text-white hover:text-purple-400 transition-colors duration-200"
        data-astro-prefetch
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1">
          <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"></path>
          <path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        </svg>
        Home
      </a>
    </div>

    <!-- Servers Menu Item -->
    <div data-nav="menu-servers" class="hidden">
      <!-- Skeleton -->
      <div data-skeleton="menu-servers" class="flex flex-col items-center justify-center p-2 animate-pulse">
        <div class="w-6 h-6 mb-1 bg-gray-600 rounded"></div>
        <div class="w-12 h-2 bg-gray-600 rounded"></div>
      </div>
      <!-- Actual Content -->
      <a
        data-content="menu-servers"
        href="/servers"
        class="hidden flex-col items-center justify-center p-2 text-xs text-white hover:text-purple-400 transition-colors duration-200"
        data-astro-prefetch
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1">
          <rect width="20" height="8" x="2" y="14" rx="2"></rect>
          <path d="M6.01 18H6"></path>
          <path d="M10.01 18H10"></path>
          <path d="M15 10v4"></path>
          <path d="M17.84 7.17a4 4 0 0 0-5.66 0"></path>
          <path d="M20.66 4.34a8 8 0 0 0-11.31 0"></path>
        </svg>
        Servers
      </a>
    </div>

    <!-- Features Menu Item -->
    <div data-nav="menu-features" class="hidden">
      <!-- Skeleton -->
      <div data-skeleton="menu-features" class="flex flex-col items-center justify-center p-2 animate-pulse">
        <div class="w-6 h-6 mb-1 bg-gray-600 rounded"></div>
        <div class="w-14 h-2 bg-gray-600 rounded"></div>
      </div>
      <!-- Actual Content -->
      <a
        data-content="menu-features"
        href="/features"
        class="hidden flex-col items-center justify-center p-2 text-xs text-white hover:text-purple-400 transition-colors duration-200"
        data-astro-prefetch
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
        Features
      </a>
    </div>

    <!-- Pricing Menu Item -->
    <div data-nav="menu-pricing" class="hidden">
      <!-- Skeleton -->
      <div data-skeleton="menu-pricing" class="flex flex-col items-center justify-center p-2 animate-pulse">
        <div class="w-6 h-6 mb-1 bg-gray-600 rounded"></div>
        <div class="w-10 h-2 bg-gray-600 rounded"></div>
      </div>
      <!-- Actual Content -->
      <a
        data-content="menu-pricing"
        href="/pricing"
        class="hidden flex-col items-center justify-center p-2 text-xs text-white hover:text-purple-400 transition-colors duration-200"
        data-astro-prefetch
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1">
          <line x1="12" y1="2" x2="12" y2="22"></line>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
        Pricing
      </a>
    </div>

    <!-- Avatar Section (always present) -->
    <div data-nav="avatar" class="ml-4 relative flex">
      <!-- Avatar Loading Skeleton -->
      <div data-skeleton="avatar" class="flex items-center gap-2 p-1">
        <div class="w-8 h-8 bg-gray-600 rounded-full animate-pulse"></div>
      </div>

      <!-- Avatar Guest State -->
      <div data-nav="avatar-guest" class="hidden absolute top-full left-0 right-0 md:static md:ml-0 bg-gradient-to-r from-gray-800 via-gray-700 to-gray-600 md:bg-transparent border-t border-gray-600 md:border-0">
        <div class="flex gap-2 px-4 py-2 md:p-0">
          <a
            href="/login"
            class="text-xs text-white hover:text-purple-400 transition-colors duration-200 md:p-2"
            data-astro-prefetch
          >
            Login
          </a>
          <a
            href="/register"
            class="text-xs text-white hover:text-purple-400 transition-colors duration-200 md:p-2"
            data-astro-prefetch
          >
            Register
          </a>
        </div>
      </div>

      <!-- Avatar User State -->
      <div data-nav="avatar-user" class="hidden absolute top-full left-0 right-0 md:static md:ml-0 bg-gradient-to-r from-gray-800 via-gray-700 to-gray-600 md:bg-transparent border-t border-gray-600 md:border-0">
        <!-- Mobile Layout -->
        <div class="md:hidden px-4 py-2">
          <div class="flex items-center gap-3 mb-3">
            <!-- Avatar with image -->
            <img
              data-nav="user-avatar"
              class="w-10 h-10 rounded-full hidden"
              alt="User avatar"
            />
            <!-- Avatar with initials -->
            <div data-nav="user-initials" class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-medium hidden">
              U
            </div>
            <p data-nav="user-email" class="text-xs text-gray-300">user@example.com</p>
          </div>
          <div class="space-y-2">
            <a
              href="/profile"
              class="block text-xs text-white hover:text-purple-400 transition-colors duration-200"
              data-astro-prefetch
            >
              Profile
            </a>
            <a
              href="/settings"
              class="block text-xs text-white hover:text-purple-400 transition-colors duration-200"
              data-astro-prefetch
            >
              Settings
            </a>
            <button
              data-nav="signout-button"
              class="w-full text-left text-xs text-white hover:text-purple-400 transition-colors duration-200 pt-2 border-t border-gray-700"
            >
              Sign Out
            </button>
          </div>
        </div>
        
        <!-- Desktop Layout -->
        <div class="hidden md:block relative">
          <button
            data-nav="user-button"
            class="flex items-center gap-2 p-1 rounded-full hover:bg-gray-700 transition-colors duration-200"
            aria-label="User menu"
          >
            <!-- Avatar with image -->
            <img
              data-nav="user-avatar-desktop"
              class="w-8 h-8 rounded-full hidden"
              alt="User avatar"
            />
            <!-- Avatar with initials -->
            <div data-nav="user-initials-desktop" class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white text-sm font-medium hidden">
              U
            </div>
          </button>
          
          <!-- Desktop Dropdown Menu -->
          <div data-nav="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50">
            <div class="px-4 py-2 border-b border-gray-700">
              <p data-nav="user-email-desktop" class="text-sm text-white truncate">user@example.com</p>
            </div>
            <a
              href="/profile"
              class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white"
              data-astro-prefetch
            >
              Profile
            </a>
            <a
              href="/settings"
              class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white"
              data-astro-prefetch
            >
              Settings
            </a>
            <button
              data-nav="signout-button-desktop"
              class="w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white border-t border-gray-700"
            >
              Sign Out
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Menu Button -->
    <div data-nav="mobile-button" class="md:hidden">
      <!-- Skeleton -->
      <div data-skeleton="mobile-button" class="flex flex-col items-center justify-center p-2 animate-pulse">
        <div class="w-6 h-6 mb-1 bg-gray-600 rounded"></div>
        <div class="w-8 h-2 bg-gray-600 rounded"></div>
      </div>
      <!-- Actual Content -->
      <button
        data-content="mobile-button"
        class="hidden flex-col items-center justify-center p-2 text-white hover:text-purple-400 transition-colors duration-200"
        aria-label="Main menu"
      >
        <svg class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <span class="text-xs">Menu</span>
      </button>
    </div>

    <!-- Mobile Menu Items (shown when mobile menu is open) -->
    <div data-nav="mobile-menu" class="hidden absolute top-full left-0 right-0 bg-gradient-to-r from-gray-800 via-gray-700 to-gray-600 border-t border-gray-600 shadow-lg md:hidden z-50">
      <div class="px-2 pt-2 pb-3 space-y-1">
        <ul class="flex flex-wrap gap-2" data-nav="mobile-menu-items">
          <!-- Mobile menu items will be populated by React -->
        </ul>
      </div>
    </div>
    
    <!-- React component will mount here -->
    <ReactNav client:only="react" />
  </div>
</div>

<style>
  /* Shimmer effect for skeleton loading */
  @keyframes shimmer {
    0% {
      background-position: -200% 0;
    }
    100% {
      background-position: 200% 0;
    }
  }

  .animate-pulse {
    background: linear-gradient(
      90deg,
      #4b5563 25%,
      #6b7280 50%,
      #4b5563 75%
    );
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite ease-in-out;
  }

  /* Smooth transitions for component visibility changes */
  [data-nav] {
    transition: opacity 0.3s ease-out;
  }

  /* Ensure consistent spacing */
  [data-nav="menu-home"],
  [data-nav="menu-servers"],
  [data-nav="menu-features"],
  [data-nav="menu-pricing"] {
    min-width: 64px;
  }
</style>