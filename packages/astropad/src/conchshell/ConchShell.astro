---
import ReactConchShell from './ReactConchShell';

export interface Props {
  initialQuestion?: string;
  flipDuration?: number;
  revealDelay?: number;
  questionPlaceholder?: string;
  submitText?: string;
  resetText?: string;
  showHistory?: boolean;
  className?: string;
  title?: string;
  subtitle?: string;
}

const {
  initialQuestion,
  flipDuration = 2000,
  revealDelay = 500,
  questionPlaceholder = "Ask the conch shell a yes/no question...",
  submitText = "üêö Consult the Oracle",
  resetText = "Reset",
  showHistory = true,
  className,
  title = "üêö Conch Shell Oracle",
  subtitle = "Ask any yes/no question and let fate decide!",
} = Astro.props;
---

<div
  class="w-full flex justify-center items-center min-h-screen p-4 sm:p-6 relative bg-cover bg-center bg-no-repeat bg-fixed"
  style="background-image: url('https://6dla38eua1.ufs.sh/f/6AKUJSzq8EG0ePbYU1I2L9CUNjXu43rioWTSGfpdzREgvPw0');"
>
  <!-- Optional overlay for better readability -->
  <div class="absolute inset-0 bg-black/10 pointer-events-none z-0"></div>

  <div
    class="w-full max-w-md mx-auto p-6 sm:p-8 rounded-2xl relative z-10 backdrop-blur-lg border shadow-2xl"
    style="
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border-color: var(--sl-color-gray-5);
      box-shadow:
        0 25px 50px -12px rgba(0, 0, 0, 0.25),
        0 10px 20px -5px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    "
  >
    <!-- Enhanced Header Section with 3D Card Effect -->
    <section
      class="text-center mb-8 relative p-6 rounded-xl"
      role="banner"
      aria-labelledby="oracle-title"
      style="
        /* 3D Card Effect */
        background: linear-gradient(145deg,
          rgba(255, 255, 255, 0.12) 0%,
          rgba(255, 255, 255, 0.08) 50%,
          rgba(255, 255, 255, 0.04) 100%);
        border: 1px solid rgba(255, 255, 255, 0.18);
        backdrop-filter: blur(12px);

        /* Inner shadow for 3D effect */
        box-shadow:
          /* Inner shadow top-left (light) */
          inset 2px 2px 8px rgba(255, 255, 255, 0.25),
          /* Inner shadow bottom-right (dark) */
          inset -2px -2px 8px rgba(0, 0, 0, 0.15),
          /* Outer glow */
          0 8px 32px rgba(138, 43, 226, 0.12),
          /* Outer shadow for depth */
          0 4px 16px rgba(0, 0, 0, 0.1);

        /* Subtle texture overlay */
        position: relative;
        overflow: hidden;
      "
    >
      <!-- Mystical glow background -->
      <div
        class="absolute inset-0 rounded-xl opacity-15 pointer-events-none"
        style="
          background: radial-gradient(ellipse at center,
            rgba(138, 43, 226, 0.4) 0%,
            rgba(30, 144, 255, 0.3) 40%,
            transparent 70%);
          animation: mysticalGlow 6s ease-in-out infinite;
        "
        aria-hidden="true"
      ></div>

      <!-- Content container with proper spacing -->
      <div class="relative z-10">
        <h1
          id="oracle-title"
          class="text-3xl sm:text-4xl font-black mb-4 tracking-wide px-4"
          style="
            background: linear-gradient(135deg,
              #ff6b6b 0%,
              #4ecdc4 25%,
              #45b7d1 50%,
              #96ceb4 75%,
              #feca57 100%);
            background-size: 200% 200%;
            animation: gradientShift 4s ease-in-out infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow:
              0 2px 4px rgba(0, 0, 0, 0.3),
              0 4px 8px rgba(0, 0, 0, 0.2),
              0 8px 16px rgba(0, 0, 0, 0.1);
            filter: drop-shadow(0 2px 8px rgba(138, 43, 226, 0.3));
          "
        >
          {title}
        </h1>

        <!-- Enhanced subtitle with better spacing -->
        <div
          class="relative mx-4 px-6 py-4 rounded-lg backdrop-blur-sm"
          style="
            background: linear-gradient(135deg,
              rgba(255, 255, 255, 0.08) 0%,
              rgba(255, 255, 255, 0.04) 100%);
            border: 1px solid rgba(255, 255, 255, 0.15);

            /* Subtle inner 3D effect for subtitle box */
            box-shadow:
              inset 1px 1px 4px rgba(255, 255, 255, 0.2),
              inset -1px -1px 4px rgba(0, 0, 0, 0.1),
              0 2px 8px rgba(0, 0, 0, 0.08);
          "
          role="complementary"
          aria-describedby="oracle-title"
        >
          <p
            class="text-sm sm:text-base font-semibold tracking-wide"
            style="
              background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.95) 0%,
                rgba(255, 255, 255, 0.75) 100%);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              background-clip: text;
              text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            "
          >
            {subtitle}
          </p>

          <!-- Subtle magical sparkles -->
          <div
            class="absolute top-2 right-3 w-2 h-2 rounded-full opacity-70"
            style="
              background: radial-gradient(circle, #feca57 0%, transparent 70%);
              animation: sparkle 2s ease-in-out infinite;
            "
            aria-hidden="true"
          ></div>
          <div
            class="absolute bottom-2 left-4 w-1 h-1 rounded-full opacity-60"
            style="
              background: radial-gradient(circle, #4ecdc4 0%, transparent 70%);
              animation: sparkle 3s ease-in-out infinite 0.5s;
            "
            aria-hidden="true"
          ></div>
        </div>
      </div>
    </section>

    <!-- Conch Shell Display Area - Fixed height to prevent layout shifts -->
    <div
      class="mb-6 flex justify-center"
      style="min-height: 200px;"
      role="img"
      aria-label="Mystical conch shell oracle"
      aria-describedby="shell-status"
    >
      <div id="conch-shell-display" class="flex flex-col items-center gap-4">
        <!-- React component will populate this area -->
      </div>
      <!-- Screen reader status updates -->
      <div id="shell-status" class="sr-only" aria-live="polite" aria-atomic="true">
        Conch shell is ready for your question
      </div>
    </div>

    <!-- React Form Component - Fixed height container to prevent layout shift -->
    <div class="space-y-4" style="min-height: 180px;">
      <ReactConchShell
        initialQuestion={initialQuestion}
        flipDuration={flipDuration}
        revealDelay={revealDelay}
        questionPlaceholder={questionPlaceholder}
        submitText={submitText}
        resetText={resetText}
        showHistory={showHistory}
        client:only="react"
      />
    </div>

    <!-- Result message area - Always reserve space to prevent layout shift -->
    <div
      id="result-area"
      style="min-height: 80px;"
      class="mt-4"
      role="region"
      aria-label="Oracle consultation result"
      aria-live="polite"
      aria-atomic="true"
    >
      <!-- React component will populate this area -->
    </div>

    <!-- Enhanced History/Stats - Professional Design -->
    <div
      id="history-stats"
      class="mt-6 pt-6 text-center hidden"
      role="complementary"
      aria-label="Consultation history and statistics"
      style="
        border-top: 1px solid rgba(255, 255, 255, 0.15);
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.01) 100%);
        border-radius: 12px 12px 0 0;
        backdrop-filter: blur(8px);
      "
    >
      <!-- Stats Header -->
      <div class="mb-4 mt-0">
        <h3
          class="text-sm font-bold tracking-wide mb-1 mt-0"
          style="
            color: rgba(255, 255, 255, 0.9);
            text-shadow:
              0 0 8px rgba(138, 43, 226, 0.6),
              0 2px 4px rgba(0, 0, 0, 0.8),
              1px 1px 0 rgba(0, 0, 0, 0.9),
              -1px -1px 0 rgba(0, 0, 0, 0.9),
              1px -1px 0 rgba(0, 0, 0, 0.9),
              -1px 1px 0 rgba(0, 0, 0, 0.9);
          "
        >
          üìä ORACLE STATISTICS
        </h3>
        <div
          class="w-16 h-0.5 mx-auto rounded-full mt-0"
          style="
            background: linear-gradient(90deg,
              rgba(138, 43, 226, 0.8) 0%,
              rgba(78, 205, 196, 0.8) 50%,
              rgba(255, 206, 87, 0.8) 100%
            );
            box-shadow: 0 0 8px rgba(138, 43, 226, 0.4);
          "
        ></div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4" role="group" aria-label="Consultation counters">
        <!-- Session consultations -->
        <div
          class="px-5 py-4 rounded-xl backdrop-blur-sm transform transition-all duration-300 hover:scale-105 mt-0"
          style="
            background: linear-gradient(145deg,
              rgba(255, 107, 107, 0.15) 0%,
              rgba(255, 107, 107, 0.08) 50%,
              rgba(255, 107, 107, 0.03) 100%
            );
            border: 1px solid rgba(255, 107, 107, 0.3);
            box-shadow:
              inset 2px 2px 4px rgba(255, 255, 255, 0.1),
              inset -2px -2px 4px rgba(0, 0, 0, 0.1),
              0 4px 16px rgba(255, 107, 107, 0.2);
          "
          role="status"
          aria-label="Current session consultations"
        >
          <div class="flex items-center justify-center gap-3 mt-0">
            <span
              class="text-2xl mt-0"
              style="
                filter: drop-shadow(0 0 8px rgba(255, 206, 87, 0.8));
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
              "
              aria-hidden="true"
            >üîÆ</span>
            <div class="text-left mt-0">
              <div
                class="text-xs font-medium uppercase tracking-wider mb-1"
                style="
                  color: rgba(255, 255, 255, 0.7);
                  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
                "
              >Session</div>
              <div
                id="session-count"
                class="text-2xl font-bold"
                style="
                  color: rgba(255, 255, 255, 0.95);
                  text-shadow:
                    0 0 12px rgba(255, 107, 107, 0.8),
                    0 2px 4px rgba(0, 0, 0, 0.8),
                    1px 1px 0 rgba(0, 0, 0, 0.9),
                    -1px -1px 0 rgba(0, 0, 0, 0.9),
                    1px -1px 0 rgba(0, 0, 0, 0.9),
                    -1px 1px 0 rgba(0, 0, 0, 0.9);
                "
                aria-live="polite"
              >0</div>
            </div>
          </div>
        </div>

        <!-- Total consultations -->
        <div
          class="px-5 py-4 rounded-xl backdrop-blur-sm transform transition-all duration-300 hover:scale-105"
          style="
            background: linear-gradient(145deg,
              rgba(78, 205, 196, 0.15) 0%,
              rgba(78, 205, 196, 0.08) 50%,
              rgba(78, 205, 196, 0.03) 100%
            );
            border: 1px solid rgba(78, 205, 196, 0.3);
            box-shadow:
              inset 2px 2px 4px rgba(255, 255, 255, 0.1),
              inset -2px -2px 4px rgba(0, 0, 0, 0.1),
              0 4px 16px rgba(78, 205, 196, 0.2);
          "
          role="status"
          aria-label="Total lifetime consultations"
        >
          <div class="flex items-center justify-center gap-3">
            <span
              class="text-2xl"
              style="
                filter: drop-shadow(0 0 8px rgba(78, 205, 196, 0.8));
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
              "
              aria-hidden="true"
            >‚ú®</span>
            <div class="text-left">
              <div
                class="text-xs font-medium uppercase tracking-wider mb-1"
                style="
                  color: rgba(255, 255, 255, 0.7);
                  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
                "
              >Total</div>
              <div
                id="total-count"
                class="text-2xl font-bold"
                style="
                  color: rgba(255, 255, 255, 0.95);
                  text-shadow:
                    0 0 12px rgba(78, 205, 196, 0.8),
                    0 2px 4px rgba(0, 0, 0, 0.8),
                    1px 1px 0 rgba(0, 0, 0, 0.9),
                    -1px -1px 0 rgba(0, 0, 0, 0.9),
                    1px -1px 0 rgba(0, 0, 0, 0.9),
                    -1px 1px 0 rgba(0, 0, 0, 0.9);
                "
                aria-live="polite"
              >0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Last consultation time -->
      <div
        id="last-flip"
        class="text-xs mt-4 pb-2 hidden"
        role="status"
        aria-label="Time of last consultation"
      >
        <div
          class="inline-flex items-center gap-2 px-3 py-2 rounded-full backdrop-blur-sm"
          style="
            background: linear-gradient(135deg,
              rgba(138, 43, 226, 0.1) 0%,
              rgba(138, 43, 226, 0.05) 100%
            );
            border: 1px solid rgba(138, 43, 226, 0.2);
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
          "
        >
          <span
            style="
              filter: drop-shadow(0 0 6px rgba(138, 43, 226, 0.8));
              text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
            "
            aria-hidden="true"
          >üïí</span>
          <span class="font-medium">Last consultation:</span>
          <span id="last-time" class="font-bold"></span>
        </div>
      </div>
    </div>

  </div>
</div>

<style>
  /* Gradient animation for title */
  @keyframes gradientShift {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  /* Sparkle animation for magical elements */
  @keyframes sparkle {
    0%, 100% {
      opacity: 0.3;
      transform: scale(0.8);
    }
    50% {
      opacity: 1;
      transform: scale(1.2);
    }
  }

  /* Enhanced glow effect for the header */
  @keyframes mysticalGlow {
    0%, 100% {
      opacity: 0.2;
      transform: scale(1.1);
    }
    50% {
      opacity: 0.4;
      transform: scale(1.2);
    }
  }

  /* Apply mystical glow animation */
  header .absolute.blur-xl {
    animation: mysticalGlow 6s ease-in-out infinite;
  }

  /* Mobile performance optimization for background */
  @media (max-width: 640px) {
    .bg-fixed {
      background-attachment: scroll !important;
    }

    /* Reduce animations on mobile for performance */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  }

  /* Tablet and high-DPI performance optimization */
  @media (min-width: 641px) and (max-width: 1024px),
         (-webkit-min-device-pixel-ratio: 2),
         (min-resolution: 192dpi) {
    .bg-fixed {
      background-attachment: scroll !important;
    }
  }

  /* Enhanced accessibility for reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .gradientShift,
    .sparkle,
    .mysticalGlow {
      animation: none !important;
    }
  }

  /* Screen reader only content */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Improved focus styles for accessibility */
  button:focus-visible,
  textarea:focus-visible {
    outline: 2px solid var(--sl-color-accent);
    outline-offset: 2px;
  }
</style>